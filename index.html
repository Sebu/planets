<!DOCTYPE html>
<html lang="en">
<head> 
	<title>webgl ancient planet visualization</title> 
	<meta charset="utf-8" />
	<link rel="stylesheet" type="text/css" href="css/planets.css">
</head>

<body>
<div class="container" id="uiContainer">
   <div title="position" style="float:left;"><img src="textures/origin.png"/><select  id="viewPos" class="view" style="position: relative;top:-6px;" onchange="model.currentPos = this.options[this.selectedIndex].value; model.changeView(model.currentPos);"></select></div>
   <div title="look at" style="float:right;"><img src="textures/lookat.png"/><select  id="lookAt" class="view" onchange="model.currentLookAt = this.options[this.selectedIndex].value;"></select></div>
	<br><br>
	<select  title="Planet presets" style="float:left;" id="planetPresets" onchange="setCurrentPlanet(this.options[this.selectedIndex].value); model.reset();"> </select>   
  <select style="float:right;" class="moon" id="moonPresets" onchange="model.setCurrentMoonModel(this.options[this.selectedIndex].value);model.reset();">  </select>	
   <div id="parameters">
      <br><br>
    <div class="caption">
     <img class="triangle" style="display:none" src="textures/open.png"/>
		 <img class="triangle" src="textures/closed.png"/>
    Show</div>
    <div id="vis">
      <input type=checkbox name="visMode" checked="true" onClick="model.visMode(0,this)">S1
      <input type=checkbox name="visMode" checked="true" onClick="model.visMode(1,this)">S2
      <input type=checkbox name="visMode" checked="true" onClick="model.visMode(2,this)">S3
      <input type=checkbox name="visMode" checked="true" onClick="model.visMode(3,this)">S4
      <br>

      <input type=checkbox name="visMode" checked="true" onClick="model.showPath=!model.showPath;">path
      <input type=checkbox name="visMode" checked="true" onClick="model.showHippo=!model.showHippo;">hippopede
       <br>
      <input type=checkbox name="visMode" checked="true" onClick="model.visMode('stars',this);">stars
      <br>

    </div>
    <div class="caption">speed</div>
   <div id="speedRange"><input type="range" class="slider" onchange="model.speed= Number(value); $('#speedRange > input').attr('value',value);"/>
   <input type="text" class="range" onchange="model.speed= Number(value); $('#speedRange > input').attr('value',value);" />
   <br><br>
   </div>

   <div class="caption moon">
     <img class="triangle" src="textures/open.png"/>
		 <img class="triangle" style="display:none" src="textures/closed.png"/>
   Moon settings</div>
   <div>
    <div class="moon" id="metonYear"><div>Years</div>
   	<input type="range" class="slider" onchange="metonYear = Number(value); $('#metonYear > input').attr('value',value);"/>
   	<input type="text" class="range" tabindex=8   onchange="metonYear = Number(value); $('#metonYear > input').attr('value',value);"/></div>
    <div class="moon" id="metonSynodicMonths"><div>Synodic months</div>
   	<input type="range" class="slider" onchange="metonSynodicMonths = Number(value); $('#metonSynodicMonths > input').attr('value',value);"/>
   	<input type="text" class="range" tabindex=9  onchange="metonSynodicMonths = Number(value); $('#metonSynodicMonths > input').attr('value',value);"/></div>  
    <div class="moon" id="metonDraconiticMonths"><div>Draconitic months</div>
   	<input type="range" class="slider" onchange="metonDraconiticMonths = Number(value); $('#metonDraconiticMonths > input').attr('value',value);"/>
   	<input type="text" class="range" tabindex=9  onchange="metonDraconiticMonths = Number(value); $('#metonDraconiticMonths > input').attr('value',value);"/></div>  
    <div class="moon" id="metonDays"><div>days per cycle</div>
   	<input type="range" class="slider" onchange="metonDays = Number(value); $('#metonDays > input').attr('value',value);"/>
   	<input type="text" class="range"  tabindex=10 onchange="metonDays = Number(value); $('#metonDays > input').attr('value',value);"/></div>  
   </div>  

    <div class="caption">
     <img class="triangle" src="textures/open.png"/>
		 <img class="triangle" style="display:none" src="textures/closed.png"/>
    Angle (degrees)</div>
		<div>
		  <div class="nomoon moon" id="latitude"><div> latitude</div>
		 	<input type="range" class="slider" onchange="model.system[0].setAxis(90-value); $('#latitude > input').attr('value',value);"/>
		 	<input type="text" class="range" tabindex=1   onchange="model.system[0].setAxis(90-value); $('#latitude > input').attr('value',value);"/></div>
		  <div class="nomoon moon angle" id="angle1"><div>S 1-2 (obliquity of ecliptic)</div>
		 	<input type="range" class="slider" onchange="model.system[1].setAxis(value); $('#angle1 > input').attr('value',value);"/>
		 	<input type="text" class="range" tabindex=1   onchange="model.system[1].setAxis(value); $('#angle1 > input').attr('value',value);"/></div>
		  <div class="nomoon moon angle" id="angle2"><div>S 2-3 (right angle)</div>
		 	<input type="range" class="slider" onchange="model.system[2].setAxis(value); $('#angle2 > input').attr('value',value);"/>
		 	<input type="text" class="range" tabindex=2  onchange="model.system[2].setAxis(value); $('#angle2 > input').attr('value',value);"/></div>  
		  <div class="nomoon angle" id="angle3"><div>S 3-4 (unknown)</div>
		 	<input type="range" class="slider" onchange="model.system[3].setAxis(value); $('#angle3 > input').attr('value',value);"/>
		 	<input type="text" class="range"  tabindex=3 onchange="model.system[3].setAxis(value); $('#angle3 > input').attr('value',value);"/></div>  
			<br><br>
		</div>
		
    <div class="nomoon moon caption">
 		 <img class="triangle" src="textures/open.png"/>
		 <img class="triangle" style="display:none" src="textures/closed.png"/>
    Sphere Period (days)</div>
		<div id="speeds">

		 <div class="nomoon moon speed" id="speed1" title="recommended 0 or 1"><div>S 1 (daily)</div>
		 <input type="range" class="slider" onchange="model.system[0].setSpeed(value); $('#speed1 > input').attr('value',value);" />
		 <input type="text" class="range"   tabindex=4 onchange="model.system[0].setSpeed(value); $('#speed1 > input').attr('value',value);"/></div>
		 <div class="speed" id="speed2"><div>S 2 (zodiacal)</div>
		 <input type="range" class="slider" onchange="model.system[1].setSpeed(value); $('#speed2 > input').attr('value',value);" />
		 <input type="text" class="range" tabindex=5  onchange="model.system[1].setSpeed(value); $('#speed2 > input').attr('value',value);"/></div>
		 <div class="speed" id="speed3"><div>S 3,4 (synodic)</div>
		 <input type="range" class="slider" onchange="model.system[2].setSpeed(value); $('#speed3 > input').attr('value',value);" />
		 <input type="text" class="range" tabindex=6  onchange="model.system[2].setSpeed(value); $('#speed3 > input').attr('value',value);"/></div>
		 <div id="speedSun"> <div>Sun (year)</div>
		 <input type="range" class="slider" onchange="sunYear = value; $('#speedSun > input').attr('value',value);" />
		 <input type="text" class="range" tabindex=7  onchange="sunYear = value; $('#speedSun > input').attr('value',value);"/></div>
		 <br><br> 
   </div>   
   
   <div class="nomoon moon caption">
 		 <img class="triangle" src="textures/open.png"/>
		 <img class="triangle" style="display:none" src="textures/closed.png"/>
   Rotation Start (degrees)</div>
   <div >
   <div class="rotate" id="rotate1"><div>S 1 (right ascension)</div>
   	<input type="range" class="slider" onchange="model.currentPlanet.sphere[1].rotate = Number(value); $('#rotate1 > input').attr('value',value);"/>
   	<input type="text" class="range" tabindex=8   onchange="model.currentPlanet.sphere[1].rotate = Number(value); $('#rotate1 > input').attr('value',value);"/></div>
   <div class="rotate" id="rotate2"><div>S 2 (longitude)</div>
   	<input type="range" class="slider" onchange="model.currentPlanet.sphere[2].rotate = Number(value); $('#rotate2 > input').attr('value',value);"/>
   	<input type="text" class="range" tabindex=9  onchange="model.currentPlanet.sphere[2].rotate = Number(value); $('#rotate2 > input').attr('value',value);"/></div>  
   <div class="rotate" id="rotate3"><div>S 3-4 (synodic)</div>
   	<input type="range" class="slider" onchange="model.currentPlanet.sphere[3].rotate = Number(value); $('#rotate3 > input').attr('value',value);"/>
   	<input type="text" class="range"  tabindex=10 onchange="model.currentPlanet.sphere[3].rotate = Number(value); $('#rotate3 > input').attr('value',value);"/></div>  
   	</div>   

  	
  <input type="button" onclick="model.reset()" value="reset">
   </div>
</div>


<div class="container moon" id="infoContainer">
  <div>zodiacal month</div><div id="metonZodicalMonths">0</div>
 <div>days per year</div><div id="metonDaysPerYear">0</div>
 <div>days per synodic month</div><div id="synodicDaysPerMonth">0</div>
 <div>days per zodical month</div><div id="zodicalDaysPerMonth">0</div>
 <div>days per draconitic month</div> <div id="draconiticDaysPerMonth">0</div>
</div>


<canvas id="glCanvas" tabindex=1>
  <p>This example requires a browser that supports the
     <a href="http://www.w3.org/html/wg/html5/">HTML5</a> 
     &lt;canvas&gt; and <a href="http://www.khronos.org/webgl/WebGL">WebGL</a> features.</p> 
</canvas>


<script type="text/javascript" src="libs/jquery.tools.min.js"></script>
<script type="text/javascript" src="libs/scenejs.min.js"></script> 
<script type="text/javascript" src="libs/scenejs-query-node-pos.js"></script> 
<script type="text/javascript" src="libs/sylvester.js"></script> 

<script type="text/javascript" src="libs/scenejs.ext.js"></script> 
<script type="text/javascript" src="libs/planetsviz_base.js"></script>
<script type="text/javascript" src="config.js"></script>
  
<script type="text/javascript"> 



// setup site
$(document).ready(function() {

//	$(".view").hide();
	model = new PModel();

	canvas = document.getElementById("glCanvas");
	canvas.addEventListener('mousedown', function(e) { model.mouseDown(e); }, true);
	canvas.addEventListener('mousemove', function(e) { model.mouseMove(e); }, true);
	canvas.addEventListener('mouseup', function(e) { model.mouseUp(e); }, true);
	canvas.addEventListener('keypress', function(e) { model.keyboard(e); }, true);
	canvas.addEventListener('mousewheel', function(e) { model.mouseWheel(e); }, true);
	canvas.addEventListener('DOMMouseScroll', function(e) { model.mouseWheel_firefox(e); }, true);
	
	$.extend(model.currentPlanet, planetPresets["Mercury1"]);
	
	$("#vis").hide();
	viewPoints = ["Free", "Earth", "Planet"];
	
  for(i in viewPoints )
 		$("#viewPos,#lookAt").append("<option value='" + viewPoints[i].toLowerCase() + "'>" + viewPoints[i] + "</option>");

	$("#lookAt option[value='earth']").attr('selected',true);
 		
 	// populate menues
  for(i in planetPresets)
 		$("#planetPresets").append("<option value='" + i + "'>" + i + "</option>");
  for(i in moonModels) 
 		$("#moonPresets").append("<option value='" + i + "'>" + i + "</option>");


	// animate hide/show
	// TODO: add triangle :)
	$(".caption").click(function() {
		$(".triangle",this).toggle();
	  $(this).next().toggle(0)
	})


	$("#speed3 > input").change(function() {
		if(model.currentPlanet.type=="planet") {
			model.system[3].setSpeed(-model.system[2]._speed);
		}
		else if(model.currentPlanet.type=="sun") {
  	  sunSpeed =   (360.0*model.system[1]._speed)/(365.25-model.system[1]._speed);
  	  //sunSpeed = (metonDaysPerYear()*systemSun[0].speed) / (systemSun[0].speed-metonDaysPerYear());
//  	  console.log(sunSpeed);
      $("#speed3 > input").attr({"value":sunSpeed });
			model.system[2].setSpeed(sunSpeed);	
			model.system[3].setSpeed(0);	
		}
	});
	

	// onchange of a moon parameter -> update model	
	$(".moon > input").change(function() {

		if(model.currentPlanet.type=="moon") {
		
			$("#metonZodicalMonths").html( metonZodicalMonths().toFixed() );
			$("#metonDaysPerYear").html( metonDaysPerYear().toFixed(2) );
			$("#synodicDaysPerMonth").html( synodicDaysPerMonth().toFixed(2) );
			$("#zodicalDaysPerMonth").html( zodicalDaysPerMonth().toFixed(2) );
			$("#draconiticDaysPerMonth").html( draconiticDaysPerMonth().toFixed(2) );

			draco = draconiticDaysPerMonth();
			zodic = zodicalDaysPerMonth();

      $("#speed2 > input").attr({"value": moonSpeed1(draco, zodic) });
      $("#speed3 > input").attr({"value": moonSpeed2(draco, zodic) });

			model.system[1].setSpeed( moonSpeed1(draco, zodic) );
			model.system[2].setSpeed( moonSpeed2(draco, zodic) );
			model.system[3].setSpeed( 0 );
		}

	});
	

	// moon sliders setup
	$("#metonSynodicMonths > input").attr({ "min":0, "max":1000});
	$("#metonDraconiticMonths > input").attr({ "min":0, "max":1000});
	$("#metonYear > input").attr({ "min":0, "max":100});
	$("#metonDays > input").attr({ "min":0, "max":30000});

	// SETUP START
	// start models
	setCurrentPlanet("Mercury1");
	model.setCurrentMoonModel("Mendell");

	model.systemSun[0].setVisuals(["equator","npole","spole","rotationarc","markerarc","arc1","arc2","markerball"], false);
	model.systemSun[1].setVisuals(["equator","npole","spole","rotationarc","markerarc","arc1","arc2","markerball"], false);
	model.reset();	

	setInterval("model.update()", 33);  

	window.onresize=model.resize();
	model.resize();
	
})


function setCurrentPlanet(node) {
	
		model.currentPlanet = {
		  sunDist: 8,
		  color:colors["Planet"],
		  type: "planet",
		  beta: 90.0,
		  sphere: [
    		{angle: 24.0, speed: 0, rotate: 0 },
    		{angle: 90.0,  speed: 365, rotate: 0 },
    		{angle: 18.0, speed: 570, rotate: 0 },
    		{angle: 0.0, speed: 0, rotate: 0 },
    		],
		};
		
		$.extend(true, model.currentPlanet, planetPresets[node]);
		
		$("#speedSun > input").attr({"value":model.sunYear,"min":0, "max":1000});
  	$("#speedSun > input").attr({"value":model.sunYear});
		$("#speedRange > input").attr({"value":model.speed,"min":0, "max":2, "step":0.01});
		$("#speedRange > input").attr({"value":model.speed});
				
		$(".angle > input").attr({"min":"0", "max":360, "step":0.05});
		$(".angle").attr("value", function(index,value) { $("input",this).attr("value",model.currentPlanet.sphere[index].angle); } );

    // TODO: maximum :)
    
		$(".speed > input").attr({"min":0, "max":11000});
		$(".speed").attr("value", function(index,value) { $("input",this).attr("value",model.currentPlanet.sphere[index].speed); } );

		$(".rotate > input").attr({"min":"0", "max":360, "step":0.05});
		$(".rotate").attr("value", function(index,value) { $("input",this).attr("value",model.currentPlanet.sphere[index].rotate); } );
		

		$("#latitude > input").attr({"min":"0", "max":90});
		$("#latitude > input").attr({"value":"38"});

		$(".angle > input").change();
		$(".speed > input").change();
		
		model.sun.setDist(model.currentPlanet.sunDist);
		model.planet.setBeta(model.currentPlanet.beta);
		model.system[3].setArcBeta(180-model.currentPlanet.beta);
	
				
		if(model.currentPlanet.type=="moon") {
			//$(".angle").hide();
			$(".rotate").hide();	
      $(".nomoon").hide();
      model.sun.setEnabled(false);
			$(".moon").show();
		  $("#metonSynodicMonths > input").attr({"value":model.currentPlanet.metonSynodicMonths});
		  $("#metonDraconiticMonths > input").attr({"value":model.currentPlanet.metonDraconiticMonths});

			$("#metonYear > input").attr({"value":model.currentPlanet.metonYear});
	  	$("#metonDays > input").attr({"value":model.currentPlanet.metonDays});
	  	$(".moon > input").change();					
		} else if(model.currentPlanet.type=="planet") {
			$(".moon").hide();
      $(".nomoon").show();
			$(".angle").show();
			$(".rotate").hide();
			$("#angle3").show();
  		$("#speed3").show();
      model.sun.setEnabled(true);				
		} else if(model.currentPlanet.type=="sun") {
			$(".moon").hide();
      $(".nomoon").show();
			$(".angle").show();
  		$("#angle3").hide();
  		$("#speed3").hide();
			$(".rotate").show();
			model.sun.setEnabled(false);	
			
//			model.system[0].setEnabled(false);
		}
	

		//$(".rotate > input").change();
	//	reset();
}






					







</script>
</body>
</html>
