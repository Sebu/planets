<!DOCTYPE html>
<html lang="en">
<head>
    <title>webgl ancient planet visualization</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="css/planets.css">
</head>

<div class="container" id="uiContainer">
    <div id="parameters"></div>
    <input type="button" onclick="model.reset()" value="reset">
</div>

<div id="mainBox" tabindex=1>
    <canvas tabindex=1 id='glCanvas'><p>This example requires a browser that supports the<a
            href='http://www.w3.org/html/wg/html5/'>HTML5</a>&lt;canvas&gt; and <a
            href='http://www.khronos.org/webgl/WebGL'>WebGL</a>features.</p></canvas>
</div>

<div class="container" id="infoContainer">
    <div>zodiacal month</div>
    <div id="metonZodicalMonths">a</div>
    <div>days per year</div>
    <div id="metonDaysPerYear">b</div>
    <div>days per synodic month</div>
    <div id="synodicDaysPerMonth">0c</div>
    <div>days per zodical month</div>
    <div id="zodicalDaysPerMonth">d</div>
    <div>days per draconitic month</div>
    <div id="draconiticDaysPerMonth">e</div>
</div>


<script type="text/javascript" src="libs/jquery.tools.min.js"></script>
<script type="text/javascript" src="libs/sylvester.js"></script>
<script type="text/javascript" src="libs/scenejs.js"></script>
<script type="text/javascript" src="libs/scenejs-query-node-pos.js"></script>
<script type="text/javascript" src="libs/scenejs.ext.js"></script>


<script type="text/javascript" src="libs/BasePlanetModel.js"></script>
<script type="text/javascript" src="libs/UIHelpers.js"></script>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="models/Model4.js"></script>
<script type="text/javascript" src="models/ModelMoon.js"></script>
<script type="text/javascript" src="models/ModelSun.js"></script>
<script type="text/javascript" src="models/ModelYavetz.js"></script>

<script type="text/javascript">


    // setup site
    $(document).ready(function() {

        //	$(".view").hide();
        renderer = new BaseScene();
        models = {}; //new Object;
        models["Model4"] = new Model4({renderer: renderer});
        models["ModelYavetz"] = new ModelYavetz({renderer: renderer});
        models["ModelMoon"] =  new ModelMoon({renderer: renderer});
        models["ModelSun"] =  new ModelSun({renderer: renderer});
        model = models["ModelYavetz"];

        $("#uiContainer").prepend("<div title='look at'><select  id='moonModel' onchange='model.setCurrentMoonModel(this.options[this.selectedIndex].value);model.reset();'></select></div>");
        UI.optionsFromHash("#moonModel", moonModels);

        $("#uiContainer").prepend("<div title='look at'><select title='Planet presets' id='planetPreset' onchange='setCurrentPlanet(this.options[this.selectedIndex].value);'> </select></div>");
        UI.optionsFromHash("#planetPreset", planetPresets);

        $("#vis").hide();
        $("#uiContainer").prepend("<div title='look at' ><img src='textures/lookat.png'><select  id='lookAt' class='view' onchange='model.currentLookAt = this.options[this.selectedIndex].value;'></select></div>");
        $("#uiContainer").prepend("<div title='position'><img src='textures/origin.png'><select  id='viewPos' class='view' style='position: relative;top:-6px;' onchange='model.currentPos = this.options[this.selectedIndex].value; model.changeView(model.currentPos);'></select></div>");
        UI.optionsFromHash("#viewPos,#lookAt", model.viewPoints);
        $("#lookAt option[value='Earth']").attr('selected', true);



        // SETUP START
        // start models
        setCurrentPlanet("Mercury1");

        // TODO: fix/move to renderer
        canvas = document.getElementById("glCanvas");
        canvas.addEventListener('mousedown', function(e) {
            renderer.mouseDown(e);
        }, true);
        canvas.addEventListener('mousemove', function(e) {
            renderer.mouseMove(e);
        }, true);
        canvas.addEventListener('mouseup', function(e) {
            renderer.mouseUp(e);
        }, true);
        canvas.addEventListener('keypress', function(e) {
            renderer.keyboard(e);
        }, true);
        canvas.addEventListener('mousewheel', function(e) {
            renderer.mouseWheel(e);
        }, true);
        canvas.addEventListener('DOMMouseScroll', function(e) {
            renderer.mouseWheel_firefox(e);
        }, true);
        setInterval("model.update()", 33);
        window.onresize = renderer.resize();
        model.resize();


    })

    function setCurrentPlanet(node) {

        // switch model
        model.root.setEnabled(false);
        model = models[planetPresets[node].model];
        model.setCurrentPlanet(planetPresets[node]);
        model.root.setEnabled(true);

        // build up ui
        $("#infoContainer").hide();
        $("#moonPresets").hide();
        $("#parameters > *").remove();

        UI.slider({model:"model", id: "Speed", min:0, max:2, step: 0.01, text: "Speed"}).appendTo("#parameters");
        //$("#speedSun > input").attr({"min":0, "max":1000,"value":model.getsunYear});

        UI.box("vis", "Show").appendTo("#parameters");
        UI.checkbox({model:"model", id:"showSphere0", text:"S1"}).appendTo("#vis");
        UI.checkbox({model:"model", id:"showSphere1", text:"S2"}).appendTo("#vis");
        UI.checkbox({model:"model", id:"showSphere2", text:"S3"}).appendTo("#vis");
        UI.checkbox({model:"model", id:"showSphere3", text:"S4"}).appendTo("#vis");
        UI.checkbox({model:"model", id:"showPath", text:"path"}).appendTo("#vis");
        UI.checkbox({model:"model", id:"showHippo", text:"hippo"}).appendTo("#vis");
        UI.checkbox({model:"model", id:"showStars", text:"stars"}).appendTo("#vis");



        if (model.name == "ModelMoon") {

            UI.box("moon", "Moon settings").appendTo("#parameters");
            UI.slider({model:"model", id:"MetonYear", "max":100, text:"Years"}).appendTo("#moon");
            UI.slider({model:"model", id:"MetonSynodicMonths", "max":1000, text:"Synodic months"}).appendTo("#moon");
            UI.slider({model:"model", id:"MetonDraconiticMonths", "max":1000, text:"Draconitic months"}).appendTo("#moon");
            UI.slider({model:"model", id:"MetonDays", "max":30000, text:"days per cycle"}).appendTo("#moon");

            UI.box("angle", "Angle (degrees)").appendTo("#parameters");
            UI.slider({model:"model", id: "AxisAngle0", max: 360, step:0.05, text: "latitude"}).appendTo("#angle");
            UI.slider({model:"model", id: "AxisAngle1", max: 360, step:0.05, text: "S 1-2 (obliquity of ecliptic)"}).appendTo("#angle");
            UI.slider({model:"model", id: "AxisAngle2", max: 360, step:0.05, text: "S 2-3 (right angle)"}).appendTo("#angle");

            UI.box("speed", "Sphere Period (days)").appendTo("#parameters");
            UI.slider({model:"model", id:"Speed0",  max:1100, text:"S 1 (daily)"}).appendTo("#speed");
            UI.slider({model:"model", id:"Speed1",  max:1100, text:"S 2 (zodiacal)"}).appendTo("#speed");
            UI.slider({model:"model", id: "Speed2", max:1100, text:"S 3 (synodic)"}).appendTo("#speed");

            $("#moon input").change();

            $("#infoContainer,#moonPresets").show();

            // moon sliders setup
            // onchange of a moon parameter -> update model
            $("#MetonYear > input,#MetonSynodicMonths > input,#MetonDraconiticMonths > input,#MetonDays > input").change(function() {

                console.log("change we can believe in");
                $("#metonZodicalMonths").html(model.getMetonZodicalMonths().toFixed());
                $("#metonDaysPerYear").html(model.getMetonDaysPerYear().toFixed(2));
                $("#synodicDaysPerMonth").html(model.getSynodicDaysPerMonth().toFixed(2));
                $("#zodicalDaysPerMonth").html(model.getZodicalDaysPerMonth().toFixed(2));
                $("#draconiticDaysPerMonth").html(model.getDraconiticDaysPerMonth().toFixed(2));

                model.updateMoon();
                $("#Speed1 > input").attr({"value": model.moonSpeed1(model.draco, model.zodic) });
                $("#Speed2 > input").attr({"value": model.moonSpeed2(model.draco, model.zodic) });

            });

            $("#moon input").change();
            
        } else if (model.name == "ModelYavetz") {

             UI.box("angle", "Angle (degrees)").appendTo("#parameters");
             UI.slider({model:"model", id: "AxisAngle0", max: 360, step:0.05, text: "latitude"}).appendTo("#angle");
             UI.slider({model:"model", id: "AxisAngle1", max: 360, step:0.05, text: "S 1-2 (obliquity of ecliptic)"}).appendTo("#angle");
             UI.slider({model:"model", id: "AxisAngle2", max: 360, step:0.05, text: "S 2-3 (right angle)"}).appendTo("#angle");
             UI.slider({model:"model", id: "AxisAngle3", max: 360, step:0.05, text: "alpha"}).appendTo("#angle");
             UI.slider({model:"model", id: "Beta", max: 360, step:0.05, text: "beta"}).appendTo("#angle");

             UI.box("speed", "Sphere Period (days)").appendTo("#parameters");
             UI.slider({model:"model", id:"Speed0",  max:1100, text:"S 1 (daily)"}).appendTo("#speed");
             UI.slider({model:"model", id:"Speed1",  max:1100, text:"S 2 (zodiacal)"}).appendTo("#speed");
             UI.slider({model:"model", id: "Speed2", max:1100, text:"S 3,4 (synodic)"}).appendTo("#speed");

             UI.box("rotateStart", "Rotation Start (degrees)").appendTo("#parameters");
             UI.slider({model:"model", id:"RotateStart0", max: 360, step:0.05, text:"S 1 (right ascension)"}).appendTo("#rotateStart");
             UI.slider({model:"model", id:"RotateStart1", max: 360, step:0.05, text:"S 2 (longitude)"}).appendTo("#rotateStart");
             UI.slider({model:"model", id:"RotateStart2", max: 360, step:0.05, text:"S 3-4 (synodic)"}).appendTo("#rotateStart");


        } else if (model.name == "Model4") {

            UI.box("angle", "Angle (degrees)").appendTo("#parameters");
            UI.slider({model:"model", id: "AxisAngle0", max: 360, step:0.05, text: "latitude"}).appendTo("#angle");
            UI.slider({model:"model", id: "AxisAngle1", max: 360, step:0.05, text: "S 1-2 (obliquity of ecliptic)"}).appendTo("#angle");
            UI.slider({model:"model", id: "AxisAngle2", max: 360, step:0.05, text: "S 2-3 (right angle)"}).appendTo("#angle");
            UI.slider({model:"model", id: "AxisAngle3", max: 360, step:0.05, text: "S 3-4 (unknown)"}).appendTo("#angle");

            UI.box("speed", "Sphere Period (days)").appendTo("#parameters");
            UI.slider({model:"model", id:"Speed0",  max:1100, text:"S 1 (daily)"}).appendTo("#speed");
            UI.slider({model:"model", id:"Speed1",  max:1100, text:"S 2 (zodiacal)"}).appendTo("#speed");
            UI.slider({model:"model", id: "Speed2", max:1100, text:"S 3,4 (synodic)"}).appendTo("#speed");

            UI.box("rotateStart", "Rotation Start (degrees)").appendTo("#parameters");
            UI.slider({model:"model", id:"RotateStart0", max: 360, step:0.05, text:"S 1 (right ascension)"}).appendTo("#rotateStart");
            UI.slider({model:"model", id:"RotateStart1", max: 360, step:0.05, text:"S 2 (longitude)"}).appendTo("#rotateStart");
            UI.slider({model:"model", id:"RotateStart2", max: 360, step:0.05, text:"S 3-4 (synodic)"}).appendTo("#rotateStart");


        } else if (model.name == "ModelSun") {

            UI.box("angle", "Angle (degrees)").appendTo("#parameters");
            UI.slider({model:"model", id: "AxisAngle0", max: 360, step:0.05, text: "latitude"}).appendTo("#angle");
            UI.slider({model:"model", id: "AxisAngle1", max: 360, step:0.05, text: "S 1-2 (obliquity of ecliptic)"}).appendTo("#angle");
            UI.slider({model:"model", id: "AxisAngle2", max: 360, step:0.05, text: "S 2-3 (right angle)"}).appendTo("#angle");

            UI.box("speed", "Sphere Period (days)").appendTo("#parameters");
            UI.slider({model:"model", id:"Speed0",  max:1100, text:"S 1 (daily)"}).appendTo("#speed");
            UI.slider({model:"model", id:"Speed1",  max:1100, text:"S 2 (zodiacal)"}).appendTo("#speed");
            UI.slider({model:"model", id: "Speed2", max:1100, text:"S 3 (synodic)"}).appendTo("#speed");

        }

        $("#angle  input, #speed  input").change();

    }

</script>

</body>
</html>
