<!DOCTYPE html>
<html lang="en">
<head>
    <title>webgl ancient planet visualization</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="css/planets.css">
</head>

<div class="container" id="uiContainer">

</div>

<div id="mainBox" tabindex=1>
    <canvas tabindex=1 id='glCanvas'><p>This example requires a browser that supports the<a
            href='http://www.w3.org/html/wg/html5/'>HTML5</a>&lt;canvas&gt; and <a
            href='http://www.khronos.org/webgl/WebGL'>WebGL</a>features.</p></canvas>
</div>

<div class="container" id="legendContainer">
</div>

<div class="container" id="infoContainer">
<div id="moonInfoContainer" style="display:none">
    <div>zodiacal month</div>
    <div id="metonZodicalMonths">0</div>
    <div>days per year</div>
    <div id="metonDaysPerYear">0</div>
    <div>days per synodic month</div>
    <div id="synodicDaysPerMonth">0</div>
    <div>days per zodical month</div>
    <div id="zodicalDaysPerMonth">0</div>
    <div>days per draconitic month</div>
    <div id="draconiticDaysPerMonth">0</div>
</div>
</div>


<script type="text/javascript" src="libs/jquery.tools.min.js"></script>
<script type="text/javascript" src="libs/sylvester.js"></script>
<script type="text/javascript" src="libs/scenejs.min.js"></script>
<script type="text/javascript" src="libs/scenejs-query-node-pos.js"></script>
<script type="text/javascript" src="libs/scenejs.ext.js"></script>


<script type="text/javascript" src="libs/BasePlanetModel.js"></script>
<script type="text/javascript" src="libs/UIHelpers.js"></script>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="models/ModelMoonCompare.js"></script>
<script type="text/javascript">



    // setup site
    $(document).ready(function() {

        renderer = new BaseScene();
        model =  new ModelMoonCompare({renderer: renderer});

        $("#uiContainer").append("<span><select  id='viewPresets' onchange=' model.currentPos = model.viewPresets[this.value].from; model.changeView(model.currentPos); model.currentLookAt=model.viewPresets[this.value].at; '></select></span>");
        UI.optionsFromHash("#viewPresets", model.viewPresets);

        $("#uiContainer").append("<span><select  id='longitudePresets' onchange='$(\"#AxisAngle0 > input\").attr(\"value\",latitudePresets[this.value]); $(\"#AxisAngle0 >input\").change();  '></select></span>");
        UI.optionsFromHash("#longitudePresets", latitudePresets);

        $("#viewPresets option[value='World']").attr('selected', true);



        $("#uiContainer").append("<div id='parameters'></div><input type='button' onclick='model.reset()' value='reset'><input type='button' onclick='model.pause()' value='pause'>");  

        $("#vis").hide();


        setCurrentPlanet("MoonMeton");


        // TODO: fix/move to renderer
        canvas = document.getElementById("glCanvas");
        canvas.addEventListener('mousedown', function(e) {
            renderer.mouseDown(e);
        }, true);
        canvas.addEventListener('mousemove', function(e) {
            renderer.mouseMove(e);
        }, true);
        canvas.addEventListener('mouseup', function(e) {
            renderer.mouseUp(e);
        }, true);
        canvas.addEventListener('keypress', function(e) {
            renderer.keyboard(e);
        }, true);
        canvas.addEventListener('mousewheel', function(e) {
            renderer.mouseWheel(e);
        }, true);
        canvas.addEventListener('DOMMouseScroll', function(e) {
            renderer.mouseWheel_firefox(e);
        }, true);
        setInterval("model.update()", 33);
        window.onresize = renderer.resize();
        model.resize();


    })



    function setCurrentPlanet(node) {

        // switch model
        model.root.setEnabled(false);
        model.setCurrentPlanet(planetPresets["MoonMeton"]);
        model.reset();
        model.root.setEnabled(true);

        // build up uisetCurrentPlanet(planetPresets["MoonMeton"]);
        $("#moonInfoContainer").fadeOut(500);
        $("#moonModel").fadeOut(500);
        $("#parameters > *").remove();
        $("#legendContainer > *").remove();


            UI.slider({model:"model", id: "AxisAngle0", max: 360, step:0.05, text: "view latitude"}).appendTo("#parameters");

        UI.slider({model:"model", id: "Speed", min:0.001, max:2000, step: 0.1, text: "Animation Speed"}).appendTo("#parameters");

        UI.box({id:"vis", text:"Show"}).appendTo("#parameters");
        for(i in model.sphere) {
            UI.checkbox({model:"model", id:"ShowSphere"+i, text:"S"+(Number(i)+1)}).appendTo("#vis");
        }
        UI.checkbox({model:"model", id:"ShowCurve0", text:"path"}).appendTo("#vis");
        UI.checkbox({model:"model", id:"ShowCurve1", text:"hippo"}).appendTo("#vis");
        UI.checkbox({model:"model", id:"ShowStars", text:"stars"}).appendTo("#vis");



        if (model.name == "ModelMoonCompare") {
            UI.box({id:"moon", text:"Moon year month day cycle"}).appendTo("#parameters");
            UI.slider({model:"model", id:"MetonYear", "max":100, text:"Years"}).appendTo("#moon");
            UI.slider({model:"model", id:"MetonSynodicMonths", "max":1000, text:"Synodic months"}).appendTo("#moon");
            UI.slider({model:"model", id:"MetonDays", "max":30000, text:"days"}).appendTo("#moon");
            
            UI.box({id:"moon2", text:"Eclipse period"}).appendTo("#parameters");
            UI.slider({model:"model", id:"MetonDraconiticMonths", "max":1000, text:"Draconitic months"}).appendTo("#moon2");

            UI.box({id:"angle", text:"Angle (degrees)"}).appendTo("#parameters");
            UI.slider({model:"model", id: "AxisAngle1", max: 360, step:0.05, text: "S 1-2 (obliquity of ecliptic)"}).appendTo("#angle");
            UI.slider({model:"model", id: "AxisAngle2", max: 360, step:0.05, text: "S 2-3 (right angle)"}).appendTo("#angle");

            UI.box({id:"speed", text:"Sphere Period (days)"}).appendTo("#parameters");
            UI.slider({model:"model", id:"Speed0",  max:1100, text:"S 1 (daily)"}).appendTo("#speed");
            UI.slider({model:"model", id:"Speed1", min: -600, max:600, text:"S 2 (zodiacal)"}).appendTo("#speed");
            UI.slider({model:"model", id:"Speed2", min: -600, max:600, text:"S 3 (synodic)"}).appendTo("#speed");

            $("#moon input").change();

            $("#moonInfoContainer,#moonModel").fadeIn(500);

            // moon sliders setup
            // onchange of a moon parameter -> update model
            $("#MetonYear > input,#MetonSynodicMonths > input,#MetonDraconiticMonths > input,#MetonDays > input").change(function() {

                $("#metonZodicalMonths").html(model.getMetonZodicalMonths().toFixed());
                $("#metonDaysPerYear").html(model.getMetonDaysPerYear().toFixed(2));
                $("#synodicDaysPerMonth").html(model.getSynodicDaysPerMonth().toFixed());
                $("#zodicalDaysPerMonth").html(model.getZodicalDaysPerMonth().toFixed());
                $("#draconiticDaysPerMonth").html(model.getDraconiticDaysPerMonth().toFixed());
                $("#Speed1 > input").attr({"value": model.moonSpeed1(model.draco, model.zodic) });
                $("#Speed2 > input").attr({"value": model.moonSpeed2(model.draco, model.zodic) });

            });
//            $("#Speed1 > input").attr({"value": model.moonSpeed1(model.draco, model.zodic) });
//            $("#Speed2 > input").attr({"value": model.moonSpeed2(model.draco, model.zodic) });            
            
            $("#MetonYear > input").change();
            
        } 

        $("#capvis,#caprotateStart").click();
        $("#moon input, #angle  input, #speed  input").change();
//        $("#rotateStart,#vis").hide();
    }

</script>

</body>
</html>
